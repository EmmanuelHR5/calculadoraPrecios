<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Descuentos</title>
    
    <!-- ConfiguraciÃ³n para que parezca App Nativa en iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Calc Desc">
    
    <!-- Icono para el iPhone (Puedes cambiar esta URL por la de tu propio icono) -->
    <link rel="apple-touch-icon" href="https://img.icons8.com/color/180/discount--v1.png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react   -dom.production.min.js"></script>
    
    <!-- Babel para traducir JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Ajustes finos para iOS */
        body {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            user-select: none;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f3f4f6; /* bg-gray-100 */
        }
        /* Ocultar scrollbar */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* Estilos del slider */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 28px;
            width: 28px;
            border-radius: 50%;
            background: #ffffff;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            margin-top: -10px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #e5e7eb;
            border-radius: 999px;
        }
    </style>
</head>
<body class="bg-gray-100 h-screen w-screen overflow-hidden flex justify-center">

    <div id="root" class="w-full h-full max-w-md bg-gray-50 flex flex-col relative shadow-2xl"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Definimos los iconos como componentes SVG simples para evitar dependencias complejas
        const IconPercent = ({size=20, className}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="19" y1="5" x2="5" y2="19"></line><circle cx="6.5" cy="6.5" r="2.5"></circle><circle cx="17.5" cy="17.5" r="2.5"></circle></svg>
        );
        const IconTag = ({size=20, className}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
        );
        const IconRefresh = ({size=20, className}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 2v6h6"></path><path d="M21 12A9 9 0 0 0 6 5.3L3 8"></path><path d="M21 22v-6h-6"></path><path d="M3 12a9 9 0 0 0 15 6.7l3-2.7"></path></svg>
        );
        const IconGlobe = ({size=20, className}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
        );
        const IconExchange = ({size=20, className}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M8 3 4 7l4 4"></path><path d="M4 7h16"></path><path d="m16 21 4-4-4-4"></path><path d="M20 17H4"></path></svg>
        );

        function App() {
            const [price, setPrice] = useState('');
            const [discount, setDiscount] = useState(20);
            const [hasExtra, setHasExtra] = useState(false);
            const [extraDiscount, setExtraDiscount] = useState(10);
            
            // Currency State
            const [currency, setCurrency] = useState('MXN'); 
            const [exchangeRate, setExchangeRate] = useState(20.50);
            const [isLoadingRate, setIsLoadingRate] = useState(false);

            const [results, setResults] = useState({
                original: 0,
                savings: 0,
                final: 0,
                finalConverted: 0
            });

            // Lista con 15% incluido
            const commonDiscounts = [10, 15, 20, 25, 30, 40, 50, 70];

            useEffect(() => {
                if (currency === 'USD') {
                    fetchExchangeRate();
                }
            }, [currency]);

            const fetchExchangeRate = async () => {
                setIsLoadingRate(true);
                try {
                    const response = await fetch('https://open.er-api.com/v6/latest/USD');
                    const data = await response.json();
                    if (data && data.rates && data.rates.MXN) {
                        setExchangeRate(parseFloat(data.rates.MXN.toFixed(2)));
                    }
                } catch (error) {
                    console.error("Could not fetch rate, using default.");
                } finally {
                    setIsLoadingRate(false);
                }
            };

            useEffect(() => {
                calculate();
            }, [price, discount, hasExtra, extraDiscount, currency, exchangeRate]);

            const calculate = () => {
                const originalPrice = parseFloat(price);
                
                if (isNaN(originalPrice) || originalPrice <= 0) {
                    setResults({ original: 0, savings: 0, final: 0, finalConverted: 0 });
                    return;
                }

                // First discount calculation
                const firstDiscountAmount = originalPrice * (discount / 100);
                let currentPrice = originalPrice - firstDiscountAmount;
                let totalSavings = firstDiscountAmount;

                // Extra discount calculation
                if (hasExtra) {
                    const extraAmount = currentPrice * (extraDiscount / 100);
                    totalSavings += extraAmount;
                    currentPrice -= extraAmount;
                }

                const finalConverted = currency === 'USD' ? currentPrice * exchangeRate : 0;

                setResults({
                    original: originalPrice,
                    savings: totalSavings,
                    final: currentPrice,
                    finalConverted: finalConverted
                });
            };

            const formatCurrency = (value, curr = currency) => {
                return new Intl.NumberFormat('es-MX', {
                    style: 'currency',
                    currency: curr,
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).format(value);
            };

            const handlePriceChange = (e) => {
                const value = e.target.value;
                if (value === '' || /^\d*\.?\d*$/.test(value)) {
                    setPrice(value);
                }
            };

            return (
                <div className="flex flex-col h-full bg-gray-50">
                    
                    {/* Fake Status Bar Spacing for PWA */}
                    <div className="h-12 w-full bg-gray-50 shrink-0"></div>

                    {/* Header */}
                    <div className="px-6 pb-4 bg-gray-50 flex justify-between items-center shrink-0">
                        <h1 className="text-3xl font-bold text-gray-900 tracking-tight">Descuentos</h1>
                        
                        <div className="bg-gray-200 p-1 rounded-lg flex text-xs font-semibold">
                            <button 
                                onClick={() => setCurrency('MXN')}
                                className={`px-4 py-1.5 rounded-md transition-all ${currency === 'MXN' ? 'bg-white shadow-sm text-black' : 'text-gray-500'}`}
                            >
                                MXN
                            </button>
                            <button 
                                onClick={() => setCurrency('USD')}
                                className={`px-4 py-1.5 rounded-md transition-all ${currency === 'USD' ? 'bg-white shadow-sm text-black' : 'text-gray-500'}`}
                            >
                                USD
                            </button>
                        </div>
                    </div>

                    {/* Scrollable Content */}
                    <div className="flex-1 overflow-y-auto no-scrollbar pb-10">
                        <div className="px-5 space-y-5 pt-2">

                            {/* Price Input */}
                            <div className="bg-white p-5 rounded-2xl shadow-sm transition-all duration-300">
                                <label className="text-gray-500 text-xs font-bold uppercase tracking-wider ml-1 flex items-center justify-between">
                                    <span>Precio Original ({currency})</span>
                                    {currency === 'USD' && <span className="text-blue-500 flex items-center gap-1"><IconGlobe size={10}/> Modo USA</span>}
                                </label>
                                <div className="mt-2 flex items-center">
                                    <span className="text-4xl font-light text-gray-300 mr-2">{currency === 'USD' ? 'US$' : '$'}</span>
                                    <input
                                        type="text"
                                        inputMode="decimal"
                                        placeholder="0"
                                        value={price}
                                        onChange={handlePriceChange}
                                        className="w-full text-5xl font-semibold text-gray-900 placeholder-gray-200 outline-none bg-transparent"
                                    />
                                    {price && (
                                        <button 
                                            onClick={() => setPrice('')}
                                            className="p-2 bg-gray-100 rounded-full text-gray-400 hover:bg-gray-200 transition"
                                        >
                                            <IconRefresh size={16} />
                                        </button>
                                    )}
                                </div>
                            </div>

                            {/* Exchange Rate (USD only) */}
                            {currency === 'USD' && (
                                <div className="bg-blue-50 p-4 rounded-2xl border border-blue-100 animate-[fadeIn_0.3s_ease-out]">
                                    <div className="flex justify-between items-center">
                                        <div className="flex items-center space-x-2 text-blue-700">
                                            <IconExchange size={16} />
                                            <span className="text-xs font-bold uppercase tracking-wide">Tipo de Cambio</span>
                                        </div>
                                        {isLoadingRate && <span className="text-xs text-blue-400 animate-pulse">Actualizando...</span>}
                                    </div>
                                    <div className="mt-2 flex items-center bg-white rounded-xl px-3 py-2 border border-blue-100">
                                        <span className="text-gray-400 text-sm mr-2">1 USD =</span>
                                        <span className="text-gray-900 font-bold">$</span>
                                        <input
                                            type="number"
                                            value={exchangeRate}
                                            onChange={(e) => setExchangeRate(e.target.value)}
                                            className="w-20 font-bold text-gray-900 outline-none bg-transparent"
                                        />
                                        <span className="text-gray-400 text-sm ml-1">MXN</span>
                                    </div>
                                </div>
                            )}

                            {/* Discount Selector */}
                            <div>
                                <div className="flex justify-between items-center mb-3 px-1">
                                    <label className="text-gray-500 text-xs font-bold uppercase tracking-wider">Descuento Principal</label>
                                </div>
                                
                                <div className="bg-white p-5 rounded-2xl shadow-sm mb-4 pt-12">
                                    <div className="relative w-full">
                                        {/* Floating Bubble */}
                                        <div 
                                            className="absolute -top-10 bg-blue-600 text-white text-sm font-bold py-1 px-3 rounded-lg shadow-md transition-all"
                                            style={{ left: `${discount}%`, transform: 'translateX(-50%)' }}
                                        >
                                            {discount}%
                                            <div className="absolute bottom-[-5px] left-1/2 -translate-x-1/2 w-0 h-0 border-l-[6px] border-r-[6px] border-t-[6px] border-l-transparent border-r-transparent border-t-blue-600"></div>
                                        </div>

                                        <input
                                            type="range"
                                            min="0"
                                            max="100"
                                            step="5"
                                            value={discount}
                                            onChange={(e) => setDiscount(Number(e.target.value))}
                                            className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600"
                                        />
                                    </div>
                                </div>

                                <div className="grid grid-cols-4 gap-3">
                                    {commonDiscounts.map((val) => (
                                        <button
                                            key={val}
                                            onClick={() => setDiscount(val)}
                                            className={`py-3 rounded-xl text-sm font-bold transition-all duration-200 ${
                                                discount === val 
                                                    ? 'bg-blue-600 text-white shadow-lg shadow-blue-200 transform scale-105' 
                                                    : 'bg-white text-gray-600 hover:bg-gray-50'
                                            }`}
                                        >
                                            {val}%
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Extra Discount Section */}
                            <div className="bg-white rounded-2xl shadow-sm overflow-hidden">
                                <div className="p-4 flex items-center justify-between border-b border-gray-100">
                                    <div className="flex items-center space-x-3">
                                        <div className={`p-2 rounded-lg ${hasExtra ? 'bg-orange-100 text-orange-600' : 'bg-gray-100 text-gray-400'}`}>
                                            <IconTag size={20} />
                                        </div>
                                        <span className="font-medium text-gray-900">Desc. Adicional</span>
                                    </div>
                                    
                                    <button 
                                        onClick={() => setHasExtra(!hasExtra)}
                                        className={`w-12 h-7 rounded-full transition-colors duration-300 focus:outline-none relative ${
                                            hasExtra ? 'bg-green-500' : 'bg-gray-300'
                                        }`}
                                    >
                                        <div className={`absolute top-0.5 left-0.5 w-6 h-6 bg-white rounded-full shadow-sm transition-transform duration-300 ${
                                            hasExtra ? 'transform translate-x-5' : ''
                                        }`}></div>
                                    </button>
                                </div>

                                {hasExtra && (
                                    <div className="px-5 pb-6 pt-12 bg-gray-50">
                                        <div className="relative w-full">
                                            <div 
                                                className="absolute -top-10 bg-green-500 text-white text-sm font-bold py-1 px-3 rounded-lg shadow-md transition-all"
                                                style={{ left: `${(extraDiscount / 30) * 100}%`, transform: 'translateX(-50%)' }}
                                            >
                                                {extraDiscount}%
                                                <div className="absolute bottom-[-5px] left-1/2 -translate-x-1/2 w-0 h-0 border-l-[6px] border-r-[6px] border-t-[6px] border-l-transparent border-r-transparent border-t-green-500"></div>
                                            </div>

                                            <input
                                                type="range"
                                                min="0"
                                                max="30"
                                                step="5"
                                                value={extraDiscount}
                                                onChange={(e) => setExtraDiscount(Number(e.target.value))}
                                                className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-green-500"
                                            />
                                        </div>
                                        <div className="flex justify-between mt-2 text-xs text-gray-400 font-medium px-1">
                                            <span>0%</span>
                                            <span>30%</span>
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Results */}
                            <div className="bg-white rounded-3xl shadow-xl p-6 relative overflow-hidden mb-8">
                                <div className="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-blue-400 via-purple-500 to-pink-500"></div>
                                
                                <div className="space-y-4 pt-2">
                                    <div className="flex justify-between text-gray-500 text-sm font-medium">
                                        <span>Precio Original</span>
                                        <span className="line-through">{formatCurrency(results.original)}</span>
                                    </div>
                                    
                                    <div className="flex justify-between text-green-600 font-bold text-base">
                                        <div className="flex items-center">
                                            <IconPercent size={16} className="mr-1.5" />
                                            <span>Ahorro Total</span>
                                        </div>
                                        <span>- {formatCurrency(results.savings)}</span>
                                    </div>

                                    <div className="border-t border-gray-100 my-2 pt-4">
                                        <div className="flex justify-between items-end">
                                            <span className="text-gray-900 font-bold text-lg mb-1">Total a Pagar</span>
                                            <span className="text-4xl font-extrabold text-gray-900 tracking-tight">
                                                {formatCurrency(results.final)}
                                            </span>
                                        </div>
                                        {currency === 'USD' && results.final > 0 && (
                                            <div className="mt-4 bg-gray-50 rounded-xl p-3 flex justify-between items-center border border-gray-100">
                                                <span className="text-xs font-bold text-gray-500 uppercase">En Pesos (MXN)</span>
                                                <span className="text-2xl font-bold text-blue-600">
                                                    {formatCurrency(results.finalConverted, 'MXN')}
                                                </span>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                            
                            <div className="h-10"></div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>